class ChatEngine{constructor(e,s,i,a,t,n){this.chatBox=$(`#${e}`),this.userEmail=i,this.userId=s,this.userName=a,this.userProfile=t,this.socket=io.connect(n,{transports:["websocket"],secure:!0,reconnect:!0,rejectUnauthorized:!1,userId:s}),this.chatRooms=["Global"],this.userEmail&&this.connectionHandler()}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("connection established using sockets...!"),e.socket.emit("user_online",{user_id:e.userId})})),e.socket.on("connections",(function(e){$("#active-users").html('<i class="fa-solid fa-circle"></i> '+(e.count-1)+" Online")})),e.socket.on("update_status",(function(e){e.map&&e.map.forEach((function(e,s){let i=$(`#status-${e.userId}`);"online"===e.status&&i.length>0?i.html('<i class="fa-solid fa-circle"></i> Active Now'):i.length>0&&i.html('<i class="fa-solid fa-circle"></i> Offline')}))})),$("#global-chat-btn").click((function(){e.socket.emit("join_global_room",{user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),chatroom:"Global"}),e.socket.on("user_joined",(function(e){}))})),$(".friend").click((function(){let s=$(this).attr("id"),i=e.userId,a=s+i;e.socket.emit("join_private_room",{user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),from_user:i,to_user:s,chatroom:a}),e.socket.on("user_joined",(function(e){})),document.getElementById("chat-user-id").value==s&&$(`#chat-messages-list-private-${s}`).children().remove()})),$("#send-message-global").click((function(){let s=$("#chat-message-input-global").val();if(""!=s){"Global Chat"==document.getElementById("chat-room-").innerText&&e.socket.emit("send_global_message",{message:s,user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),chatroom:"Global"})}})),$("#send-message-private").click((function(){let s=$("#chat-message-input-private").val();if(""!=s){const i=document.getElementById("chat-user-id").value,a=e.userId;let t=i+a;e.socket.emit("send_private_message",{message:s,user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),from_user:a,to_user:i,chatroom:t})}})),$("#chat-message-input-global").keypress((function(e){13==e.which&&$("#send-message-global").click()})),$("#chat-message-input-private").keypress((function(e){13==e.which&&$("#send-message-private").click()})),e.socket.on("receive_global_message",(function(s){let i=$("<li>");$("<img>");i.addClass("animate__animated  animate__fadeIn");let a="other-message animate__animated  animate__fadeIn";if(s.user_email==e.userEmail?(a="self-message",i.append(`<div class="msg-content">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                <img src="${s.user_profile}">\n                            </div>`)):i.append(`<div class="msg-content">\n                                <img src="${s.user_profile}">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                \n                            </div>`),$("#chat-messages-list-global li").length){let e=$("#chat-messages-list-global li:last-child");e.find("sub").html()==s.user_name&&(e.find("sub").remove(),e.find("img").css("visibility","hidden"),e.hasClass("self-message"),e.css("margin-bottom","0px"),i.css("margin-top","0px"))}i.append($("<sub>",{html:s.user_name})),i.addClass(a),$("#chat-messages-list-global").append(i),$("#chat-message-input-global").val("")})),e.socket.on("receive_private_message",(function(s){let i=document.getElementById("chat-user-id").value,a=$("<li>");$("<img>");a.addClass("animate__animated  animate__fadeIn");let t="other-message animate__animated  animate__fadeIn";if(s.user_email==e.userEmail?(t="self-message",a.append(`<div class="msg-content">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                <img src="${s.user_profile}">\n                            </div>`)):a.append(`<div class="msg-content">\n                                <img src="${s.user_profile}">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                \n                            </div>`),$(`#chat-messages-list-private-${i} li`).length){let e=$(`#chat-messages-list-private-${i} li:last-child`);e.find("sub").html()==s.user_name&&(e.find("sub").remove(),e.find("img").css("visibility","hidden"),e.hasClass("self-message"),e.css("margin-bottom","0px"),a.css("margin-top","0px"))}a.append($("<sub>",{html:s.user_name})),a.addClass(t),$(`#chat-messages-list-private-${i}`).append(a),$("#chat-message-input-private").val("")}))}}