class ChatEngine{constructor(e,s,t,i,a,n){this.chatBox=$(`#${e}`),this.userEmail=t,this.userId=s,this.userName=i,this.userProfile=a,this.socket=io.connect(n,{transports:["websocket"],secure:!0,reconnect:!0,rejectUnauthorized:!1,query:{userId:this.userId}}),this.chatRooms=["Global"],this.userEmail&&this.connectionHandler()}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("connection established using sockets...!"),e.socket.emit("user_online",{user_id:e.userId})})),e.socket.on("connections",(function(e){$("#active-users").html('<i class="fa-solid fa-circle"></i> '+(e.count-1)+" Online")})),e.socket.on("update_status",(function(e){e.map&&e.map.forEach((function(e,s){let t=$(`#status-${e.userId}`);"online"===e.status&&t.length>0?t.html('<i class="fa-solid fa-circle"></i> Active Now'):t.length>0&&(e.moment?t.html("Active "+e.moment):t.html("offline"))}))})),$("#global-chat-btn").click((function(){e.socket.emit("join_global_room",{user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),chatroom:"Global"}),e.socket.on("user_joined",(function(e){}))})),$(".friend").click((function(){let s=$(this).attr("id"),t=e.userId,i=s+t;e.socket.emit("join_private_room",{user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),from_user:t,to_user:s,chatroom:i}),e.socket.on("user_joined",(function(e){})),document.getElementById("chat-user-id").value==s&&$(`#chat-messages-list-private-${s}`).children().remove()})),$("#send-message-global").click((function(){let s=$("#chat-message-input-global").val();if(""!=s){"Global Chat"==document.getElementById("chat-room-").innerText&&e.socket.emit("send_global_message",{message:s,user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),chatroom:"Global"})}})),$("#send-message-private").click((function(){let s=$("#chat-message-input-private").val();if(""!=s){const t=document.getElementById("chat-user-id").value,i=e.userId;let a=t+i;e.socket.emit("send_private_message",{message:s,user_email:e.userEmail,user_name:e.userName,user_profile:e.userProfile,time:(new Date).toLocaleTimeString("en-US",{hour12:!0,hour:"numeric",minute:"numeric"}),from_user:i,to_user:t,chatroom:a})}})),$("#chat-message-input-global").keypress((function(e){13==e.which&&$("#send-message-global").click()})),$("#chat-message-input-private").keypress((function(e){13==e.which&&$("#send-message-private").click()})),e.socket.on("receive_global_message",(function(s){let t=$("<li>");$("<img>");t.addClass("animate__animated  animate__fadeIn");let i="other-message animate__animated  animate__fadeIn";if(s.user_email==e.userEmail?(i="self-message",t.append(`<div class="msg-content">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                <img src="${s.user_profile}">\n                            </div>`)):t.append(`<div class="msg-content">\n                                <img src="${s.user_profile}">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                \n                            </div>`),$("#chat-messages-list-global li").length){let e=$("#chat-messages-list-global li:last-child");e.find("sub").html()==s.user_name&&(e.find("sub").remove(),e.find("img").css("visibility","hidden"),e.hasClass("self-message"),e.css("margin-bottom","0px"),t.css("margin-top","0px"))}t.append($("<sub>",{html:s.user_name})),t.addClass(i),$("#chat-messages-list-global").append(t),$("#chat-message-input-global").val("")})),e.socket.on("receive_private_message",(function(s){let t=document.getElementById("chat-user-id").value;if(t!=s.from_user&&t!=s.to_user)return;let i=$("<li>");$("<img>");i.addClass("animate__animated  animate__fadeIn");let a="other-message animate__animated  animate__fadeIn";if(s.user_email==e.userEmail?(a="self-message",i.append(`<div class="msg-content">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                <img src="${s.user_profile}">\n                            </div>`)):i.append(`<div class="msg-content">\n                                <img src="${s.user_profile}">\n                                <span>\n                                    ${s.message} <sup>${s.time}</sup> \n                                </span>\n                                \n                            </div>`),$(`#chat-messages-list-private-${t} li`).length){let e=$(`#chat-messages-list-private-${t} li:last-child`);e.find("sub").html()==s.user_name&&(e.find("sub").remove(),e.find("img").css("visibility","hidden"),e.hasClass("self-message"),e.css("margin-bottom","0px"),i.css("margin-top","0px"))}i.append($("<sub>",{html:s.user_name})),i.addClass(a),$(`#chat-messages-list-private-${t}`).append(i),$("#chat-message-input-private").val("")})),$("#close-chat-window").click((function(){$(this).parent().parent().remove()}))}}